"use strict";(self["webpackChunkrbac_demo_front"]=self["webpackChunkrbac_demo_front"]||[]).push([[464],{9464:function(e,t,s){s.r(t),s.d(t,{default:function(){return p}});var l=function(){var e=this,t=e._self._c;return t("div",[t("div",[e.hasAuth("dept:add")?t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("新增部门")]):e._e()],1),t("el-table",{staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.tableData,"row-key":"id",border:"","default-expand-all":"","tree-props":{children:"child",hasChildren:"hasChildren"}},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{prop:"name",label:"部门名",width:"180"}}),t("el-table-column",{attrs:{prop:"p_dept_name",label:"父部门",width:"180"}}),t("el-table-column",{attrs:{prop:"user_count",label:"员工数",width:"180"}}),t("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(s){return[s.row.status?t("el-tag",{attrs:{size:"small",type:"success"}},[e._v("正常")]):t("el-tag",{attrs:{size:"small",type:"danger"}},[e._v("禁用")])]}}])}),t("el-table-column",{attrs:{prop:"create_time",label:"创建时间"}}),t("el-table-column",{attrs:{prop:"mod",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(s){return[e.hasAuth("dept:mod")?t("el-button",{attrs:{type:"primary",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.editDept(s.row.id)}}}):e._e(),e.hasAuth("dept:del")?t("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.delDept(s.row.id)}}}):e._e()]}}])})],1),t("el-dialog",{attrs:{title:e.title,visible:e.dialogVisible,width:"30%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,"status-icon":"",rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"部门名",prop:"name"}},[t("el-input",{model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),t("el-form-item",{attrs:{label:"父部门",prop:"dept"}},[t("treeselect",{staticStyle:{width:"170px"},attrs:{placeholder:"选择部门",flat:!0,options:e.depts},on:{input:e.showDept},model:{value:e.ruleForm.p_dept,callback:function(t){e.$set(e.ruleForm,"p_dept",t)},expression:"ruleForm.p_dept"}})],1),t("el-form-item",{attrs:{label:"是否启用",prop:"status"}},[t("el-switch",{model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.addDept}},[e._v("确 定")])],1)],1)],1)},i=[],o=s(7859),a=s.n(o),r={name:"DeptView",data(){return{title:"新增",defaultProps:{children:"children",label:"label"},depts:[],tableData:[],multipleSelection:[],dialogVisible:!1,ruleForm:{name:"",p_dept:null,status:!0},rules:{name:[{required:!0,message:"请输入部门名",trigger:"blur"},{min:3,max:5,message:"长度在 2 到 6 个字符",trigger:"blur"}]}}},methods:{showDept(){this.ruleForm.p_dept||(this.ruleForm.p_dept=null),console.log(this.ruleForm)},editDept(e){this.$axios.get(this.$settings.BASE_URL+"/permission/dept/"+e+"/",{headers:{Authorization:this.$cookies.get("token")}}).then((e=>{this.ruleForm=e.data.data,console.log(this.ruleForm),this.title="修改",this.dialogVisible=!0}))},delDept(e){this.$axios.delete(this.$settings.BASE_URL+"/permission/dept/"+e+"/",{headers:{Authorization:this.$cookies.get("token"),Auth:"dept:del"}}).then((e=>{this.$message({showClose:!0,message:"删除成功",type:"success",onClose:()=>{this.getDept(),this.getTreeDept()}})}))},handleClose(e){this.$confirm("确认关闭？").then((e=>{this.dialogVisible=!1,this.ruleForm={name:"",p_dept:null,status:!0},this.title="新增"})).catch((e=>{}))},handleSelectionChange(e){this.multipleSelection=e,console.log(this.multipleSelection)},getDept(){this.$axios.get(this.$settings.BASE_URL+"/permission/dept/",{headers:{Authorization:this.$cookies.get("token")}}).then((e=>{this.tableData=e.data.data.results}))},getTreeDept(){this.$axios.get(this.$settings.BASE_URL+"/permission/dept/all_dept/",{headers:{Authorization:this.$cookies.get("token")}}).then((e=>{this.depts=e.data.data.results}))},addDept(){console.log(this.ruleForm);let e=this.$axios.post;this.ruleForm.id&&(e=this.$axios.put),e(this.$settings.BASE_URL+"/permission/dept/"+(this.ruleForm.id?this.ruleForm.id+"/":""),this.ruleForm,{headers:{Authorization:this.$cookies.get("token"),Auth:this.ruleForm.id?"dept:mod":"dept:add"}}).then((e=>{this.$message({showClose:!0,message:"操作成功",type:"success",onClose:()=>{this.getDept(),this.getTreeDept(),this.dialogVisible=!1,this.ruleForm={name:"",p_dept:null,status:!0}}})}))}},created(){this.getDept(),this.getTreeDept()},components:{Treeselect:a()}},n=r,d=s(1001),u=(0,d.Z)(n,l,i,!1,null,"e3837f02",null),p=u.exports}}]);
//# sourceMappingURL=464.40423c68.js.map