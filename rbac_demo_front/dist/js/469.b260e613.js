"use strict";(self["webpackChunkrbac_demo_front"]=self["webpackChunkrbac_demo_front"]||[]).push([[469],{8469:function(t,e,s){s.r(e),s.d(e,{default:function(){return d}});var a=function(){var t=this,e=t._self._c;return e("div",[e("div",[e("el-autocomplete",{attrs:{"fetch-suggestions":t.querySearchAsync,placeholder:"请输入搜索内容","trigger-on-focus":!1},on:{input:t.handInput},model:{value:t.state,callback:function(e){t.state=e},expression:"state"}}),e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:t.searchUser}},[t._v(" 搜索 ")]),t.hasAuth("job:add")?e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("新增部门")]):t._e(),t.hasAuth("job:del")?e("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.delJob(null)}}},[t._v("批量删除")]):t._e()],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:t.tableData,"row-key":"id",border:""},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection",width:"55"}}),e("el-table-column",{attrs:{prop:"name",label:"岗位名",width:"180"}}),e("el-table-column",{attrs:{prop:"dept_name",label:"所属部门",width:"180"}}),e("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(s){return[s.row.status?e("el-tag",{attrs:{size:"small",type:"success"}},[t._v("正常")]):e("el-tag",{attrs:{size:"small",type:"danger"}},[t._v("禁用")])]}}])}),e("el-table-column",{attrs:{prop:"create_time",label:"创建时间"}}),e("el-table-column",{attrs:{prop:"mod",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(s){return[t.hasAuth("job:mod")?e("el-button",{attrs:{type:"primary",icon:"el-icon-edit",circle:""},on:{click:function(e){return t.editJob(s.row.id)}}}):t._e(),t.hasAuth("job:del")?e("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(e){return t.delJob(s.row.id)}}}):t._e()]}}])})],1),e("el-dialog",{attrs:{title:t.title,visible:t.dialogVisible,width:"30%","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:t.ruleForm,"status-icon":"",rules:t.rules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"岗位名",prop:"name"}},[e("el-input",{model:{value:t.ruleForm.name,callback:function(e){t.$set(t.ruleForm,"name",e)},expression:"ruleForm.name"}})],1),e("el-form-item",{attrs:{label:"所属部门",prop:"dept"}},[e("treeselect",{staticStyle:{width:"170px"},attrs:{placeholder:"选择所属部门",flat:!0,options:t.depts},model:{value:t.ruleForm.dept,callback:function(e){t.$set(t.ruleForm,"dept",e)},expression:"ruleForm.dept"}})],1),e("el-form-item",{attrs:{label:"是否启用",prop:"status"}},[e("el-switch",{model:{value:t.ruleForm.status,callback:function(e){t.$set(t.ruleForm,"status",e)},expression:"ruleForm.status"}})],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.handleClose}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.setJob}},[t._v("确 定")])],1)],1),e("el-pagination",{attrs:{layout:"prev, pager, next",total:t.count,"page-size":5},on:{"next-click":t.nextPage,"current-change":t.getPage,"prev-click":t.prevPage}})],1)},i=[],o=(s(7658),s(7859)),l=s.n(o),r={name:"JobView",data(){return{loading:!1,prev_page:"",next_page:"",count:"",restaurants:[],state:"",timeout:null,depts:[],ruleForm:{name:"",dept:null,status:!0},rules:{name:[{required:!0,message:"请输入岗位名",trigger:"blur"},{min:2,max:5,message:"长度在 2 到 6 个字符",trigger:"blur"}]},multipleSelection:[],dialogVisible:!1,title:"新增",tableData:""}},methods:{prevPage(){this.$axios.get(this.prev_page,{headers:{Authorization:this.$cookies.get("token")}}).then((t=>{this.tableData=t.data.data.results,this.next_page=t.data.data.next}))},getPage(t){this.$axios.get(this.$settings.BASE_URL+"/permission/job/?page="+t,{headers:{Authorization:this.$cookies.get("token")}}).then((t=>{this.tableData=t.data.data.results,this.next_page=t.data.data.next,this.prev_page=t.data.data.previous}))},nextPage(){this.$axios.get(this.next_page,{headers:{Authorization:this.$cookies.get("token")}}).then((t=>{this.tableData=t.data.data.results,this.prev_page=t.data.data.previous}))},searchUser(){this.loading=!0,this.$axios.get(this.$settings.BASE_URL+"/permission/job/?search="+this.state,{headers:{Authorization:this.$cookies.get("token")}}).then((t=>{this.tableData=t.data.data.results,this.count=t.data.data.count,this.loading=!1}))},handInput(){this.loading=!0,0===this.state.length?setTimeout((()=>{this.loading=!1,this.getJob()}),1e3):setTimeout((()=>{this.loading=!1,this.$axios.get(this.$settings.BASE_URL+"/permission/job/?search="+this.state,{headers:{Authorization:this.$cookies.get("token")}}).then((t=>{this.tableData=t.data.data.results,this.count=t.data.data.count}))}),1e3)},delJob(t){let e=[];t?e.push(t):this.multipleSelection.forEach((t=>{e.push(t.id)})),this.$axios.post(this.$settings.BASE_URL+"/permission/job/del_jobs/",{ids:e},{headers:{Authorization:this.$cookies.get("token"),Auth:"job:del"}}).then((t=>{this.$message({showClose:!0,message:"删除成功",type:"success",onClose:()=>{this.getJob(),this.getTreeDept()}})}))},editJob(t){this.$axios.get(this.$settings.BASE_URL+"/permission/job/"+t+"/",{headers:{Authorization:this.$cookies.get("token")}}).then((t=>{this.ruleForm=t.data.data,this.title="修改",this.dialogVisible=!0}))},setJob(){let t=this.$axios.post;this.ruleForm.id&&(t=this.$axios.put),t(this.$settings.BASE_URL+"/permission/job/"+(this.ruleForm.id?this.ruleForm.id+"/":""),this.ruleForm,{headers:{Authorization:this.$cookies.get("token"),Auth:this.ruleForm.id?"job:mod":"job:add"}}).then((t=>{100===t.data.code&&this.$message({showClose:!0,message:"操作成功",type:"success",onClose:()=>{this.getJob(),this.getTreeDept(),this.dialogVisible=!1,this.ruleForm={name:"",dept:null,status:!0}}})}))},handleSelectionChange(t){this.multipleSelection=t},handleClose(t){this.$confirm("确认关闭？").then((t=>{this.dialogVisible=!1,this.title="新增",this.ruleForm={name:"",dept:null,status:!0}})).catch((t=>{}))},getJob(){this.$axios.get(this.$settings.BASE_URL+"/permission/job/",{headers:{Authorization:this.$cookies.get("token")}}).then((t=>{this.tableData=t.data.data.results,this.restaurants=t.data.data.results,this.count=t.data.data.count,this.next_page=t.data.data.next}))},getTreeDept(){this.$axios.get(this.$settings.BASE_URL+"/permission/dept/all_dept/",{headers:{Authorization:this.$cookies.get("token")}}).then((t=>{this.depts=t.data.data.results}))},querySearchAsync(t,e){var s=this.restaurants,a=t?s.filter(this.createStateFilter(t)):s;clearTimeout(this.timeout),this.timeout=setTimeout((()=>{e(a)}),800*Math.random())},createStateFilter(t){return console.log(t),e=>0===e.name.toLowerCase().indexOf(t.toLowerCase())},handleSelect(t){console.log(t),this.tableData=[t]}},created(){this.getJob(),this.getTreeDept()},components:{Treeselect:l()}},n=r,h=s(1001),u=(0,h.Z)(n,a,i,!1,null,"a304aedc",null),d=u.exports}}]);
//# sourceMappingURL=469.b260e613.js.map