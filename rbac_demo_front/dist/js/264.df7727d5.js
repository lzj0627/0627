"use strict";(self["webpackChunkrbac_demo_front"]=self["webpackChunkrbac_demo_front"]||[]).push([[264],{5264:function(e,t,s){s.r(t),s.d(t,{default:function(){return h}});var l=function(){var e=this,t=e._self._c;return t("div",[t("div",[e.hasAuth("role:add")?t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("新增角色")]):e._e(),e.hasAuth("role:del")?t("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.delRole(null)}}},[e._v("批量删除")]):e._e()],1),t("el-table",{staticStyle:{width:"100%","margin-top":"15px"},attrs:{data:e.tableData,border:""},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{prop:"name",label:"名称",width:"180"}}),t("el-table-column",{attrs:{prop:"msg",label:"描述",width:"180"}}),t("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(s){return[s.row.status?t("el-tag",{attrs:{size:"small",type:"success"}},[e._v("正常")]):t("el-tag",{attrs:{size:"small",type:"danger"}},[e._v("禁用")])]}}])}),t("el-table-column",{attrs:{prop:"create_time",label:"创建时间"}}),t("el-table-column",{attrs:{prop:"mod",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(s){return[e.hasAuth("role:mod")?t("el-button",{attrs:{type:"primary",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.modRole(s.row.id)}}}):e._e(),e.hasAuth("role:del")?t("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.delRole(s.row.id)}}}):e._e()]}}])})],1),t("el-dialog",{attrs:{title:e.title,visible:e.dialogVisible,width:"30%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,"status-icon":"",rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"角色名",prop:"name"}},[t("el-input",{model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),t("el-form-item",{attrs:{label:"角色介绍",prop:"msg"}},[t("el-input",{model:{value:e.ruleForm.msg,callback:function(t){e.$set(e.ruleForm,"msg",t)},expression:"ruleForm.msg"}})],1),t("el-form-item",{attrs:{label:"部门",prop:"dept"}},[t("treeselect",{staticStyle:{width:"170px"},attrs:{placeholder:"选择部门",multiple:!0,flat:!0,options:e.depts},model:{value:e.ruleForm.depts,callback:function(t){e.$set(e.ruleForm,"depts",t)},expression:"ruleForm.depts"}})],1),t("el-form-item",{attrs:{label:"菜单权限",prop:"menu"}},[t("el-tree",{ref:"permTree",attrs:{data:e.permTreeData,"show-checkbox":"","default-expand-all":!0,"node-key":"id","check-strictly":!0,props:e.defaultProps},on:{check:e.subRoleTreeCheck}})],1),t("el-form-item",{attrs:{label:"是否启用",prop:"status"}},[t("el-switch",{model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.addRole}},[e._v("确 定")])],1)],1)],1)},o=[],r=(s(7658),s(7859)),i=s.n(r),a={name:"RoleView",data(){return{title:"新增",permTreeData:[],defaultProps:{children:"children",label:"label"},depts:[],tableData:[],multipleSelection:[],dialogVisible:!1,ruleForm:{name:"",msg:"",depts:null,menus:[],status:!0},rules:{name:[{required:!0,message:"请输入角色名",trigger:"blur"},{min:3,max:5,message:"长度在 2 到 6 个字符",trigger:"blur"}]}}},methods:{modRole(e){this.$axios.get(this.$settings.BASE_URL+"/permission/role/"+e+"/",{headers:{Authorization:this.$cookies.get("token")}}).then((e=>{this.ruleForm=e.data.data,this.title="修改",this.dialogVisible=!0})),setTimeout((()=>{this.$refs.permTree.setCheckedKeys(this.ruleForm.menus)}),100)},subRoleTreeCheck(e,t){this.ruleForm.menus=this.$refs.permTree.getCheckedKeys().concat(this.$refs.permTree.getHalfCheckedKeys())},handleClose(e){this.$confirm("确认关闭？").then((e=>{this.dialogVisible=!1,this.ruleForm={name:"",msg:"",depts:null,menus:[],status:!0},this.$refs.permTree.setCheckedKeys(this.ruleForm.menus)})).catch((e=>{}))},handleSelectionChange(e){this.multipleSelection=e},getRole(){this.$axios.get(this.$settings.BASE_URL+"/permission/role/",{headers:{Authorization:this.$cookies.get("token")}}).then((e=>{this.tableData=e.data.data.results}))},delRole(e){let t=[];e?t.push(e):this.multipleSelection.forEach((e=>{t.push(e.id)})),this.$axios.post(this.$settings.BASE_URL+"/permission/role/del_roles/",{ids:t},{headers:{Authorization:this.$cookies.get("token"),Auth:"role:del"}}).then((e=>{this.$message({showClose:!0,message:"删除成功",type:"success",onClose:()=>{this.getRole()}})}))},addRole(){let e=this.$axios.post;this.ruleForm.id&&(e=this.$axios.put),e(this.$settings.BASE_URL+"/permission/role/"+(this.ruleForm.id?this.ruleForm.id+"/":""),this.ruleForm,{headers:{Authorization:this.$cookies.get("token"),Auth:this.ruleForm.id?"role:mod":"role:add"}}).then((e=>{100===e.data.code&&this.$message({showClose:!0,message:"操作成功",type:"success",onClose:()=>{this.getRole(),this.dialogVisible=!1,this.ruleForm={name:"",msg:"",depts:null,menus:[],status:!0},this.$refs.permTree.setCheckedKeys(this.ruleForm.menus)}})}))}},created(){this.getRole(),this.$axios.get(this.$settings.BASE_URL+"/permission/dept/all_dept/",{headers:{Authorization:this.$cookies.get("token")}}).then((e=>{this.depts=e.data.data.results})),this.$axios.get(this.$settings.BASE_URL+"/permission/menu/all_menu/",{headers:{Authorization:this.$cookies.get("token")}}).then((e=>{this.permTreeData=e.data.data}))},components:{Treeselect:i()}},n=a,u=s(1001),m=(0,u.Z)(n,l,o,!1,null,"e327cc86",null),h=m.exports}}]);
//# sourceMappingURL=264.df7727d5.js.map